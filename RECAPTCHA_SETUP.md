# Настройка reCAPTCHA v3 для Berlin Indoor Padel Club

## 1. Текущая конфигурация (разработка)

Проект уже настроен с **тестовым ключом Google** для разработки:
- Ключ: `6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI`
- Работает только на `localhost`
- Не требует настройки для разработки
- **reCAPTCHA v3** работает "невидимо" для пользователя

## 2. Получение собственных ключей reCAPTCHA v3 (для продакшена)

1. Перейдите на [Google reCAPTCHA Admin Console](https://www.google.com/recaptcha/admin)
2. Войдите в свой Google аккаунт
3. Нажмите "+" для создания нового сайта
4. **Выберите reCAPTCHA v3** (не v2!)
5. Добавьте домены:
   - `localhost` (для разработки)
   - `your-domain.com` (для продакшена)
6. Примите условия использования
7. Скопируйте **Site Key** и **Secret Key**

## 3. Настройка переменных окружения

Создайте файл `.env.local` в корне проекта:

```bash
# reCAPTCHA v3 Configuration
NEXT_PUBLIC_RECAPTCHA_SITE_KEY=ваш_site_key_v3_здесь
```

## 4. Обновление конфигурации

Откройте файл `src/lib/recaptcha.ts` и замените тестовый ключ на ваш реальный:

```typescript
export const RECAPTCHA_SITE_KEY = process.env.NEXT_PUBLIC_RECAPTCHA_SITE_KEY || 'ваш_site_key_v3_здесь';
```

## 5. Настройка Formspree

Форма уже настроена на отправку в Formspree:
- Endpoint: `https://formspree.io/f/xeozwkbw`
- Добавлены поля: `gdprConsent`, `captchaToken`
- reCAPTCHA v3 выполняется автоматически при отправке формы

## 6. Тестирование

1. Запустите сервер разработки: `pnpm dev`
2. Откройте страницу `/contact-us`
3. Заполните форму
4. Поставьте галочку GDPR
5. **reCAPTCHA v3 работает автоматически** - пользователь не видит капчу
6. Отправьте форму

## 7. Проверка в Formspree

1. Войдите в [Formspree Dashboard](https://formspree.io/forms)
2. Найдите форму `xeozwkbw`
3. Проверьте, что сообщения приходят с полями:
   - name, email, phone, company, message
   - language, source
   - gdprConsent, captchaToken

## Преимущества reCAPTCHA v3

- **Невидимый для пользователя** - нет необходимости кликать на чекбокс
- **Оценка риска** - Google анализирует поведение пользователя
- **Лучший UX** - пользователи не знают, что проходят проверку
- **Автоматическая защита** - работает в фоне без вмешательства

## Важные замечания

- **Тестовый ключ** работает только на `localhost` (для разработки)
- **Site Key** используется на фронтенде (публичный)
- **Secret Key** используется для серверной валидации (приватный)
- Для продакшена **обязательно** замените тестовый ключ на ваш собственный v3
- GDPR согласие обязательно для отправки формы
- reCAPTCHA v3 проверка выполняется автоматически при отправке

## Решение проблем

### "Invalid site key" ошибка
- Убедитесь, что используете правильный ключ **v3**
- Для разработки используйте тестовый ключ: `6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI`
- Для продакшена используйте ваш собственный ключ v3
- Проверьте, что домен добавлен в настройках reCAPTCHA v3
- Убедитесь, что выбрали именно reCAPTCHA v3, а не v2

### reCAPTCHA не работает
- Проверьте, что `ReCAPTCHAProvider` обернут вокруг всего приложения
- Убедитесь, что ключ правильно импортирован в `src/lib/recaptcha.ts`
- Проверьте консоль браузера на наличие ошибок JavaScript
